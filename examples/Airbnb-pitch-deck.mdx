
## Overview
This tutorial guides you through the process of extracting structured data from the Airbnb pitch deck using Retab, OpenAI, and Pydantic. We will define a schema to capture important entities from the document and use an LLM to analyze and extract relevant information.

## Prerequisites
Before proceeding, ensure you have the following installed and configured:

- Python 3.8+
- `pydantic`, `dotenv`, `retab`, `openai`
- An `.env.production` file containing your API keys
- A [airbnb_pitch_deck.pdf](https://github.com/Retab-dev/retab/blob/main/notebooks/airbnb/airbnb_pitch_deck.pdf) file in the same directory as the `main.py` file 

Install dependencies:
```bash
pip install pydantic python-dotenv retab openai
```

Download the pitch deck:
```bash
wget https://github.com/Retab-dev/retab/blob/main/notebooks/airbnb/airbnb_pitch_deck.pdf
```

## Step 1: Load Environment Variables
First, load the environment variables to access the API keys securely.

```python
from dotenv import load_dotenv
assert load_dotenv(".env.production")
```

## Step 2: Define the Schema

### System Prompt

We will start by defining a system prompt that will guide the LLM to extract the data in the correct format.

```python
system_prompt = """
Your task is to extract structured information from pitch decks based on the provided schema. Carefully analyze the content to identify relevant details and populate each field accurately while maintaining consistency across extracted data.

Key Guidelines:
	1.	Understanding the Schema:
	•	The schema includes key entities such as the company, its investors, competitors, clients, team members, and business model. Each field must be carefully reviewed and filled with precise data extracted from the deck.
	•	Relationships between companies (e.g., investor, competitor, client) should be determined based on contextual evidence within the deck.
	2.	Contextual Analysis:
	•	Consider multiple slides to understand the startup's positioning, stakeholders, and market landscape.
	•	Extract information by recognizing patterns, such as recurring names or mentions in key slides (e.g., cap tables for investors, competitive analysis for competitors, and traction slides for clients).
	3.	Consistency and Accuracy:
	•	Ensure extracted data is consistent across all fields and accurately reflects the content of the deck.
	•	Avoid duplication or conflicting information by cross-referencing details from various slides.
	4.	Data Formatting:
	•	Company Name: Extract the official name as presented in the deck, ensuring correctness.
	•	Website: Extract and format URLs correctly 
	•	Country: Convert to the appropriate two-letter country code for uniformity.
	•	Business Model: Determine whether the startup follows B2B, B2C, or C2C based on their product offerings and customer base.
	5.	Handling Team Data:
	•	Identify key team members, ensuring correct extraction of their first name, last name, title, and previous experiences.
	•	Prioritize executives and founding members when available.
	6.	Dealing with Missing Information:
	•	If some details are not explicitly stated, infer them based on available context or leave them blank if they cannot be determined with certainty.
	•	Ensure no assumptions are made beyond what is supported by the content.

Extraction Output:
	•	The extracted data should strictly adhere to the defined schema, ensuring each field is correctly populated according to its description.
	•	The output should be structured, with proper data types (e.g., strings, enumerations, lists) and validated before final submission.

By following these principles, the extracted information will be comprehensive, accurate, and aligned with the expected data structure for further processing and analysis.
"""
```

Then we define a schema using Pydantic to represent the information to be extracted from the pitch deck.

```python
from pydantic import BaseModel, Field, ConfigDict
from typing import List
from enum import Enum, IntEnum

class CompanyEnum(str, Enum):
    school = 'school'
    investor = 'investor'
    startup = 'startup'
    corporate = 'corporate'

class CompanyRelation(str, Enum):
    founderBackground = 'founderBackground'
    investor = 'investor'
    competitor = 'competitor'
    client = 'client'
    partnership = 'partnership'

class Company(BaseModel):
    name: str = Field(...,
        description="Name of the identified company",
    )
    type: CompanyEnum = Field(...,
        description="Type of the identified company",

    )
    relationship: CompanyRelation = Field(...,
        description="Relationship of the identified company with the startup from the deck",
    )

class BusinessModel(str, Enum):
    B2B = 'B2B'
    B2C = 'B2C'
    C2C = 'C2C'

class TeamMember(BaseModel):
    firstName: str = Field(...,
        description="First name of the team member",
    )
    lastName: str = Field(...,
        description="Last name of the team member",
    )
    title: str = Field(...,
        description="Title, position of the team member",
    )
    pastExperiences: str = Field(...,
        description="Previous experiences",
    )

class Deck(BaseModel):
    model_config = ConfigDict(
        json_schema_extra = {
            "X-SystemPrompt": system_prompt
        }
    )
    name: str = Field(...,
        description="Name of the company",
    )
    website: str = Field(...,
        description="URL of the company website",
    )
    country: str = Field(...,
        description="2 letter Country code of the company ",
    )
    investors: Company = Field(...,
        description="Existing investors in the startup",
        json_schema_extra={
            "X-ReasoningPrompt": "Think about the investors. Detail your thought process, and explain logically, step by step, who are the investors, detailing the cues and evidence for each one. For example: 1) Found X in cap table showing Y% ownership 2) Identified Z from 'backed by' slide with logo and investment date 3) etc."
        }
    )
    competitors: Company = Field(...,
        description="Competitors identified by the startup in the deck",
        json_schema_extra={
            "X-ReasoningPrompt": "Walk through your analysis of the competitive landscape step by step: 1) Which companies are positioned as direct competitors? 2) What specific features/offerings overlap? 3) What market segments do they compete in? 4) What evidence supports each competitor identification?"
        }
    )
    clients: Company = Field(...,
        description="Clients (B2B) in pipe or signed by the startup in the deck",
        json_schema_extra={
            "X-ReasoningPrompt": "Break down your client analysis systematically: 1) Which companies are mentioned as current clients vs pipeline? 2) What evidence shows their client status (testimonials, case studies, logos)? 3) What stage is each client relationship? 4) Are there any specific metrics or success stories mentioned?"
        }
    )
    team: List[TeamMember] = Field(...,
        description="Company Team",
        json_schema_extra={
            "X-ReasoningPrompt": "Analyze the team composition methodically: 1) Who are the key founders/executives? 2) What specific evidence validates their roles? 3) How did you verify their background and experience? 4) What makes their experience relevant to this venture?"
        }
    )
    businessModel: BusinessModel = Field(...,
        description="Business model of the startup",
        json_schema_extra={
            "X-ReasoningPrompt": "Explain your business model classification process: 1) Who are the primary customers? 2) What is the revenue generation method? 3) How does the product/service flow between parties? 4) What specific slides or content supports this classification?"
        }
    )

```

## Step 3: Load the Document
We will use `Retab` to load the pitch deck document.

```python
from retab import Retab

reclient = Retab()
doc_msg = reclient.documents.create_messages(
    document="airbnb_pitch_deck.pdf"
)
```

## Step 4: Schema Creation
We create a schema object using the `Schema` class from Retab to structure the extraction process.

<CodeGroup>
```python main.py
from retab import Schema

schema_obj = Schema(
    pydantic_model=Deck
)
```
```python json_schema.json
{
  "$defs": {
    "BusinessModel": {
      "enum": [
        "B2B",
        "B2C",
        "C2C"
      ],
      "title": "BusinessModel",
      "type": "string"
    },
    "Company": {
      "properties": {
        "name": {
          "description": "Name of the identified company",
          "title": "Name",
          "type": "string"
        },
        "type": {
          "$ref": "#/$defs/CompanyEnum",
          "description": "Type of the identified company"
        },
        "relationship": {
          "$ref": "#/$defs/CompanyRelation",
          "description": "Relationship of the identified company with the startup from the deck"
        }
      },
      "required": [
        "name",
        "type",
        "relationship"
      ],
      "title": "Company",
      "type": "object"
    },
    "CompanyEnum": {
      "enum": [
        "school",
        "investor",
        "startup",
        "corporate"
      ],
      "title": "CompanyEnum",
      "type": "string"
    },
    "CompanyRelation": {
      "enum": [
        "founderBackground",
        "investor",
        "competitor",
        "client",
        "partnership"
      ],
      "title": "CompanyRelation",
      "type": "string"
    },
    "TeamMember": {
      "properties": {
        "firstName": {
          "description": "First name of the team member",
          "title": "Firstname",
          "type": "string"
        },
        "lastName": {
          "description": "Last name of the team member",
          "title": "Lastname",
          "type": "string"
        },
        "title": {
          "description": "Title, position of the team member",
          "title": "Title",
          "type": "string"
        },
        "pastExperiences": {
          "description": "Previous experiences",
          "title": "Pastexperiences",
          "type": "string"
        }
      },
      "required": [
        "firstName",
        "lastName",
        "title",
        "pastExperiences"
      ],
      "title": "TeamMember",
      "type": "object"
    }
  },
  "X-SystemPrompt": "\nYour task is to extract structured information from pitch decks based on the provided schema. Carefully analyze the content to identify relevant details and populate each field accurately while maintaining consistency across extracted data.\n\nKey Guidelines:\n\t1.\tUnderstanding the Schema:\n\t\u2022\tThe schema includes key entities such as the company, its investors, competitors, clients, team members, and business model. Each field must be carefully reviewed and filled with precise data extracted from the deck.\n\t\u2022\tRelationships between companies (e.g., investor, competitor, client) should be determined based on contextual evidence within the deck.\n\t2.\tContextual Analysis:\n\t\u2022\tConsider multiple slides to understand the startup's positioning, stakeholders, and market landscape.\n\t\u2022\tExtract information by recognizing patterns, such as recurring names or mentions in key slides (e.g., cap tables for investors, competitive analysis for competitors, and traction slides for clients).\n\t3.\tConsistency and Accuracy:\n\t\u2022\tEnsure extracted data is consistent across all fields and accurately reflects the content of the deck.\n\t\u2022\tAvoid duplication or conflicting information by cross-referencing details from various slides.\n\t4.\tData Formatting:\n\t\u2022\tCompany Name: Extract the official name as presented in the deck, ensuring correctness.\n\t\u2022\tWebsite: Extract and format URLs correctly \n\t\u2022\tCountry: Convert to the appropriate two-letter country code for uniformity.\n\t\u2022\tBusiness Model: Determine whether the startup follows B2B, B2C, or C2C based on their product offerings and customer base.\n\t5.\tHandling Team Data:\n\t\u2022\tIdentify key team members, ensuring correct extraction of their first name, last name, title, and previous experiences.\n\t\u2022\tPrioritize executives and founding members when available.\n\t6.\tDealing with Missing Information:\n\t\u2022\tIf some details are not explicitly stated, infer them based on available context or leave them blank if they cannot be determined with certainty.\n\t\u2022\tEnsure no assumptions are made beyond what is supported by the content.\n\nExtraction Output:\n\t\u2022\tThe extracted data should strictly adhere to the defined schema, ensuring each field is correctly populated according to its description.\n\t\u2022\tThe output should be structured, with proper data types (e.g., strings, enumerations, lists) and validated before final submission.\n\nBy following these principles, the extracted information will be comprehensive, accurate, and aligned with the expected data structure for further processing and analysis.\n",
  "properties": {
    "name": {
      "description": "Name of the company",
      "title": "Name",
      "type": "string"
    },
    "website": {
      "description": "URL of the company website",
      "title": "Website",
      "type": "string"
    },
    "country": {
      "description": "2 letter Country code of the company ",
      "title": "Country",
      "type": "string"
    },
    "investors": {
      "$ref": "#/$defs/Company",
      "X-ReasoningPrompt": "Think about the investors. Detail your thought process, and explain logically, step by step, who are the investors, detailing the cues and evidence for each one. For example: 1) Found X in cap table showing Y% ownership 2) Identified Z from 'backed by' slide with logo and investment date 3) etc.",
      "description": "Existing investors in the startup"
    },
    "competitors": {
      "$ref": "#/$defs/Company",
      "X-ReasoningPrompt": "Walk through your analysis of the competitive landscape step by step: 1) Which companies are positioned as direct competitors? 2) What specific features/offerings overlap? 3) What market segments do they compete in? 4) What evidence supports each competitor identification?",
      "description": "Competitors identified by the startup in the deck"
    },
    "clients": {
      "$ref": "#/$defs/Company",
      "X-ReasoningPrompt": "Break down your client analysis systematically: 1) Which companies are mentioned as current clients vs pipeline? 2) What evidence shows their client status (testimonials, case studies, logos)? 3) What stage is each client relationship? 4) Are there any specific metrics or success stories mentioned?",
      "description": "Clients (B2B) in pipe or signed by the startup in the deck"
    },
    "team": {
      "X-ReasoningPrompt": "Analyze the team composition methodically: 1) Who are the key founders/executives? 2) What specific evidence validates their roles? 3) How did you verify their background and experience? 4) What makes their experience relevant to this venture?",
      "description": "Company Team",
      "items": {
        "$ref": "#/$defs/TeamMember"
      },
      "title": "Team",
      "type": "array"
    },
    "businessModel": {
      "$ref": "#/$defs/BusinessModel",
      "X-ReasoningPrompt": "Explain your business model classification process: 1) Who are the primary customers? 2) What is the revenue generation method? 3) How does the product/service flow between parties? 4) What specific slides or content supports this classification?",
      "description": "Business model of the startup"
    }
  },
  "required": [
    "name",
    "website",
    "country",
    "investors",
    "competitors",
    "clients",
    "team",
    "businessModel"
  ],
  "title": "Deck",
  "type": "object"
}
```
</CodeGroup>

## Step 5: Perform LLM Analysis
We use OpenAI's GPT model to analyze the document and extract structured data.

The reasoning fields (see `result_with_reasoning.json`) helps the model to reason about the data and extract it in the correct format.

<CodeGroup>
```python main.py (OpenAI Completions API)
from openai import OpenAI
import json

client = OpenAI()
completion = client.beta.chat.completions.parse(
    model="gpt-4.1-nano",
    messages=schema_obj.openai_messages + doc_msg.openai_messages,
    response_format=schema_obj.inference_pydantic_model
)

assert completion.choices[0].message.parsed is not None
print(json.dumps(completion.choices[0].message.parsed.model_dump(), indent=2))
```

```python main.py (OpenAI Responses API)
from openai import OpenAI
import json

client = OpenAI()
response = client.responses.create(
    model="gpt-4.1-nano",
    input = schema_obj.openai_responses_input + doc_msg.openai_responses_input,
    text ={
        "format": {
            "type": "json_schema",
            "json_schema": schema_obj.inference_json_schema
        }
    }
)

assert response.output_text is not None
print(response.output_text)
```

```json result_with_reasoning.json
{
  "name": "AirBed&Breakfast",
  "website": "airbedandbreakfast.com",
  "country": "US",
  "reasoning___investors": "1) The funding is specified in the Financial slide, indicating an angel round of $500K. 2) Although there are no named investors in the slides, the need for angel investment suggests relationships with high-net-worth individuals or investor groups interested in startups.",
  "investors": {
    "name": "Angel Investors",
    "type": "investor",
    "relationship": "investor"
  },
  "reasoning___competitors": "1) The competitive landscape is represented in the Competition slide which lists CouchSurfing, Craigslist, BedandBreakfast.com, Hostels.com, Rentabi.com, Orbitz, and others. 2) Features such as rental transactions and budget accommodation indicate they overlap with AirBed&Breakfast's offering.",
  "competitors": {
    "name": "CouchSurfing",
    "type": "startup",
    "relationship": "competitor"
  },
  "reasoning___clients": "1) The slides do not mention specific clients or partnerships currently signed on with AirBed&Breakfast. 2) Potential users, however, include travelers looking for budget accommodations, but this is more potential clientele than current clients.",
  "clients": {
    "name": "Travelers",
    "type": "startup",
    "relationship": "client"
  },
  "reasoning___team": "1) The team consists of Joe Gebbia, Brian Chesky, and Nathan Blecharczyk, all featured in the Team slide. 2) Each team member has definitive roles in User Interface, Business Development, and Development, which complement the startup's needs.",
  "team": [
    {
      "firstName": "Joe",
      "lastName": "Gebbia",
      "title": "User Interface & PR",
      "pastExperiences": "Entrepreneur and designer, graduated from Rhode Island School of Design."
    },
    {
      "firstName": "Brian",
      "lastName": "Chesky",
      "title": "Business Development & Brand",
      "pastExperiences": "Founder of Brian Chesky, Inc., industrial design consultant, graduated from Rhode Island School of Design."
    },
    {
      "firstName": "Nathan",
      "lastName": "Blecharczyk",
      "title": "Developer",
      "pastExperiences": "Created Facebook apps, graduate from Harvard."
    }
  ],
  "reasoning___businessModel": "1) The business model is determined by the revenue generation method which is taking a 10% commission on each transaction as stated in the Business Model slide. 2) The primary customers are travelers and local hosts, confirming B2C positioning.",
  "businessModel": "B2C"
}
```
</CodeGroup>
## Step 6: Validate Extracted Data
Finally, validate the extracted data against the schema by removing reasoning fields.

<CodeGroup>
```python main.py (OpenAI Completions API)
from main_server.libs.document_analysis.functions.json_schema  import filter_auxiliary_fields_json

assert completion.choices[0].message.content is not None
extraction = schema_obj.pydantic_model.model_validate(
    filter_auxiliary_fields_json(completion.choices[0].message.content)
)

print(json.dumps(extraction.model_dump(), indent=2))
```

```python main.py (OpenAI Responses API)
from main_server.libs.document_analysis.functions.json_schema  import filter_auxiliary_fields_json

assert response.output_text is not None
extraction = schema_obj.pydantic_model.model_validate(
    filter_auxiliary_fields_json(response.output_text)
)

print(json.dumps(extraction.model_dump(), indent=2))
```

```json final_result.json
{
  "name": "AirBed&Breakfast",
  "website": "airbedandbreakfast.com",
  "country": "US",
  "investors": {
    "name": "Angel Investors",
    "type": "investor",
    "relationship": "investor"
  },
  "competitors": {
    "name": "CouchSurfing",
    "type": "startup",
    "relationship": "competitor"
  },
  "clients": {
    "name": "Travelers",
    "type": "startup",
    "relationship": "client"
  },
  "team": [
    {
      "firstName": "Joe",
      "lastName": "Gebbia",
      "title": "User Interface & PR",
      "pastExperiences": "Entrepreneur and designer, graduated from Rhode Island School of Design."
    },
    {
      "firstName": "Brian",
      "lastName": "Chesky",
      "title": "Business Development & Brand",
      "pastExperiences": "Founder of Brian Chesky, Inc., industrial design consultant, graduated from Rhode Island School of Design."
    },
    {
      "firstName": "Nathan",
      "lastName": "Blecharczyk",
      "title": "Developer",
      "pastExperiences": "Created Facebook apps, graduate from Harvard."
    }
  ],
  "businessModel": "B2C"
}
```

</CodeGroup>

## Full Code

Here is the full code for the example:

<CodeGroup>

```python main.py (OpenAI Completions API)
from pydantic import BaseModel, Field, ConfigDict
from typing import List
from enum import Enum, IntEnum
from dotenv import load_dotenv
assert load_dotenv(".env.production") # Load environment variables from a .env file
from retab import Retab

system_prompt = """
Your task is to extract structured information from pitch decks based on the provided schema. Carefully analyze the content to identify relevant details and populate each field accurately while maintaining consistency across extracted data.

Key Guidelines:
	1.	Understanding the Schema:
	•	The schema includes key entities such as the company, its investors, competitors, clients, team members, and business model. Each field must be carefully reviewed and filled with precise data extracted from the deck.
	•	Relationships between companies (e.g., investor, competitor, client) should be determined based on contextual evidence within the deck.
	2.	Contextual Analysis:
	•	Consider multiple slides to understand the startup's positioning, stakeholders, and market landscape.
	•	Extract information by recognizing patterns, such as recurring names or mentions in key slides (e.g., cap tables for investors, competitive analysis for competitors, and traction slides for clients).
	3.	Consistency and Accuracy:
	•	Ensure extracted data is consistent across all fields and accurately reflects the content of the deck.
	•	Avoid duplication or conflicting information by cross-referencing details from various slides.
	4.	Data Formatting:
	•	Company Name: Extract the official name as presented in the deck, ensuring correctness.
	•	Website: Extract and format URLs correctly 
	•	Country: Convert to the appropriate two-letter country code for uniformity.
	•	Business Model: Determine whether the startup follows B2B, B2C, or C2C based on their product offerings and customer base.
	5.	Handling Team Data:
	•	Identify key team members, ensuring correct extraction of their first name, last name, title, and previous experiences.
	•	Prioritize executives and founding members when available.
	6.	Dealing with Missing Information:
	•	If some details are not explicitly stated, infer them based on available context or leave them blank if they cannot be determined with certainty.
	•	Ensure no assumptions are made beyond what is supported by the content.

Extraction Output:
	•	The extracted data should strictly adhere to the defined schema, ensuring each field is correctly populated according to its description.
	•	The output should be structured, with proper data types (e.g., strings, enumerations, lists) and validated before final submission.

By following these principles, the extracted information will be comprehensive, accurate, and aligned with the expected data structure for further processing and analysis.
"""

class CompanyEnum(str, Enum):
    school = 'school'
    investor = 'investor'
    startup = 'startup'
    corporate = 'corporate'

class CompanyRelation(str, Enum):
    founderBackground = 'founderBackground'
    investor = 'investor'
    competitor = 'competitor'
    client = 'client'
    partnership = 'partnership'

class Company(BaseModel):
    name: str = Field(...,
        description="Name of the identified company",
    )
    type: CompanyEnum = Field(...,
        description="Type of the identified company",
    )
    relationship: CompanyRelation = Field(...,
        description="Relationship of the identified company with the startup from the deck",
    )

class BusinessModel(str, Enum):
    B2B = 'B2B'
    B2C = 'B2C'
    C2C = 'C2C'

class TeamMember(BaseModel):
    firstName: str = Field(...,
        description="First name of the team member",
    )
    lastName: str = Field(...,
        description="Last name of the team member",
    )
    title: str = Field(...,
        description="Title, position of the team member",
    )
    pastExperiences: str = Field(...,
        description="Previous experiences",
    )

class Deck(BaseModel):
    model_config = ConfigDict(
        json_schema_extra = {
            "X-SystemPrompt": system_prompt
        }
    )
    name: str = Field(...,
        description="Name of the company",
    )
    website: str = Field(...,
        description="URL of the company website",
    )
    country: str = Field(...,
        description="2 letter Country code of the company ",
    )
    investors: Company = Field(...,
        description="Existing investors in the startup",
        json_schema_extra={
            "X-ReasoningPrompt": "Think about the investors. Detail your thought process, and explain logically, step by step, who are the investors, detailing the cues and evidence for each one. For example: 1) Found X in cap table showing Y% ownership 2) Identified Z from 'backed by' slide with logo and investment date 3) etc."
        }
    )
    competitors: Company = Field(...,
        description="Competitors identified by the startup in the deck",
        json_schema_extra={
            "X-ReasoningPrompt": "Walk through your analysis of the competitive landscape step by step: 1) Which companies are positioned as direct competitors? 2) What specific features/offerings overlap? 3) What market segments do they compete in? 4) What evidence supports each competitor identification?"
        }
    )
    clients: Company = Field(...,
        description="Clients (B2B) in pipe or signed by the startup in the deck",
        json_schema_extra={
            "X-ReasoningPrompt": "Break down your client analysis systematically: 1) Which companies are mentioned as current clients vs pipeline? 2) What evidence shows their client status (testimonials, case studies, logos)? 3) What stage is each client relationship? 4) Are there any specific metrics or success stories mentioned?"
        }
    )
    team: List[TeamMember] = Field(...,
        description="Company Team",
        json_schema_extra={
            "X-ReasoningPrompt": "Analyze the team composition methodically: 1) Who are the key founders/executives? 2) What specific evidence validates their roles? 3) How did you verify their background and experience? 4) What makes their experience relevant to this venture?"
        }
    )
    businessModel: BusinessModel = Field(...,
        description="Business model of the startup",
        json_schema_extra={
            "X-ReasoningPrompt": "Explain your business model classification process: 1) Who are the primary customers? 2) What is the revenue generation method? 3) How does the product/service flow between parties? 4) What specific slides or content supports this classification?"
        }
    )




from retab import Retab, Schema
from openai import OpenAI
from pydantic import BaseModel, Field, ConfigDict
import json

reclient = Retab()
doc_msg = reclient.documents.create_messages(
    document = "airbnb_pitch_deck.pdf"
)

schema_obj =Schema(
    pydantic_model = Deck
)

# Now you can use your favorite model to analyze your document
client = OpenAI()
completion = client.beta.chat.completions.parse(
    model="gpt-4.1-nano",
    messages=schema_obj.openai_messages + doc_msg.openai_messages,
    response_format=schema_obj.inference_pydantic_model
)

assert completion.choices[0].message.parsed is not None
print(json.dumps(completion.choices[0].message.parsed.model_dump(), indent=2))


# ------------------------------------------------------------------------------------------------

# Eventually: validate the response against the original schema if you want to remove the reasoning fields
from main_server.libs.document_analysis.functions.json_schema  import filter_auxiliary_fields_json
assert completion.choices[0].message.content is not None
extraction = schema_obj.pydantic_model.model_validate(
    filter_auxiliary_fields_json(completion.choices[0].message.content)
)
print(json.dumps(extraction.model_dump(), indent=2))
```


```python main.py (OpenAI Responses API)
from pydantic import BaseModel, Field, ConfigDict
from typing import List
from enum import Enum, IntEnum
from dotenv import load_dotenv
assert load_dotenv(".env.production") # Load environment variables from a .env file
from retab import Retab

system_prompt = """
Your task is to extract structured information from pitch decks based on the provided schema. Carefully analyze the content to identify relevant details and populate each field accurately while maintaining consistency across extracted data.

Key Guidelines:
	1.	Understanding the Schema:
	•	The schema includes key entities such as the company, its investors, competitors, clients, team members, and business model. Each field must be carefully reviewed and filled with precise data extracted from the deck.
	•	Relationships between companies (e.g., investor, competitor, client) should be determined based on contextual evidence within the deck.
	2.	Contextual Analysis:
	•	Consider multiple slides to understand the startup's positioning, stakeholders, and market landscape.
	•	Extract information by recognizing patterns, such as recurring names or mentions in key slides (e.g., cap tables for investors, competitive analysis for competitors, and traction slides for clients).
	3.	Consistency and Accuracy:
	•	Ensure extracted data is consistent across all fields and accurately reflects the content of the deck.
	•	Avoid duplication or conflicting information by cross-referencing details from various slides.
	4.	Data Formatting:
	•	Company Name: Extract the official name as presented in the deck, ensuring correctness.
	•	Website: Extract and format URLs correctly 
	•	Country: Convert to the appropriate two-letter country code for uniformity.
	•	Business Model: Determine whether the startup follows B2B, B2C, or C2C based on their product offerings and customer base.
	5.	Handling Team Data:
	•	Identify key team members, ensuring correct extraction of their first name, last name, title, and previous experiences.
	•	Prioritize executives and founding members when available.
	6.	Dealing with Missing Information:
	•	If some details are not explicitly stated, infer them based on available context or leave them blank if they cannot be determined with certainty.
	•	Ensure no assumptions are made beyond what is supported by the content.

Extraction Output:
	•	The extracted data should strictly adhere to the defined schema, ensuring each field is correctly populated according to its description.
	•	The output should be structured, with proper data types (e.g., strings, enumerations, lists) and validated before final submission.

By following these principles, the extracted information will be comprehensive, accurate, and aligned with the expected data structure for further processing and analysis.
"""

class CompanyEnum(str, Enum):
    school = 'school'
    investor = 'investor'
    startup = 'startup'
    corporate = 'corporate'

class CompanyRelation(str, Enum):
    founderBackground = 'founderBackground'
    investor = 'investor'
    competitor = 'competitor'
    client = 'client'
    partnership = 'partnership'

class Company(BaseModel):
    name: str = Field(...,
        description="Name of the identified company",
    )
    type: CompanyEnum = Field(...,
        description="Type of the identified company",
    )
    relationship: CompanyRelation = Field(...,
        description="Relationship of the identified company with the startup from the deck",
    )

class BusinessModel(str, Enum):
    B2B = 'B2B'
    B2C = 'B2C'
    C2C = 'C2C'

class TeamMember(BaseModel):
    firstName: str = Field(...,
        description="First name of the team member",
    )
    lastName: str = Field(...,
        description="Last name of the team member",
    )
    title: str = Field(...,
        description="Title, position of the team member",
    )
    pastExperiences: str = Field(...,
        description="Previous experiences",
    )

class Deck(BaseModel):
    model_config = ConfigDict(
        json_schema_extra = {
            "X-SystemPrompt": system_prompt
        }
    )
    name: str = Field(...,
        description="Name of the company",
    )
    website: str = Field(...,
        description="URL of the company website",
    )
    country: str = Field(...,
        description="2 letter Country code of the company ",
    )
    investors: Company = Field(...,
        description="Existing investors in the startup",
        json_schema_extra={
            "X-ReasoningPrompt": "Think about the investors. Detail your thought process, and explain logically, step by step, who are the investors, detailing the cues and evidence for each one. For example: 1) Found X in cap table showing Y% ownership 2) Identified Z from 'backed by' slide with logo and investment date 3) etc."
        }
    )
    competitors: Company = Field(...,
        description="Competitors identified by the startup in the deck",
        json_schema_extra={
            "X-ReasoningPrompt": "Walk through your analysis of the competitive landscape step by step: 1) Which companies are positioned as direct competitors? 2) What specific features/offerings overlap? 3) What market segments do they compete in? 4) What evidence supports each competitor identification?"
        }
    )
    clients: Company = Field(...,
        description="Clients (B2B) in pipe or signed by the startup in the deck",
        json_schema_extra={
            "X-ReasoningPrompt": "Break down your client analysis systematically: 1) Which companies are mentioned as current clients vs pipeline? 2) What evidence shows their client status (testimonials, case studies, logos)? 3) What stage is each client relationship? 4) Are there any specific metrics or success stories mentioned?"
        }
    )
    team: List[TeamMember] = Field(...,
        description="Company Team",
        json_schema_extra={
            "X-ReasoningPrompt": "Analyze the team composition methodically: 1) Who are the key founders/executives? 2) What specific evidence validates their roles? 3) How did you verify their background and experience? 4) What makes their experience relevant to this venture?"
        }
    )
    businessModel: BusinessModel = Field(...,
        description="Business model of the startup",
        json_schema_extra={
            "X-ReasoningPrompt": "Explain your business model classification process: 1) Who are the primary customers? 2) What is the revenue generation method? 3) How does the product/service flow between parties? 4) What specific slides or content supports this classification?"
        }
    )




from retab import Retab, Schema
from openai import OpenAI
from pydantic import BaseModel, Field, ConfigDict
import json

reclient = Retab()
doc_msg = reclient.documents.create_messages(
    document = "airbnb_pitch_deck.pdf"
)

schema_obj =Schema(
    pydantic_model = Deck
)

# Now you can use your favorite model to analyze your document
client = OpenAI()
response = client.responses.create(
    model="gpt-4.1-nano",
    input = schema_obj.openai_responses_input + doc_msg.openai_responses_input,
    text ={
        "format": {
            "type": "json_schema",
            "json_schema": schema_obj.inference_json_schema
        }
    }
)

assert response.output_text is not None
print(response.output_text)



# ------------------------------------------------------------------------------------------------

# Eventually: validate the response against the original schema if you want to remove the reasoning fields
from main_server.libs.document_analysis.functions.json_schema  import filter_auxiliary_fields_json
assert response.output_text is not None
extraction = schema_obj.pydantic_model.model_validate(
    filter_auxiliary_fields_json(response.output_text)
)
print(json.dumps(extraction.model_dump(), indent=2))
```


```python json_schema.json
{
  "$defs": {
    "BusinessModel": {
      "enum": [
        "B2B",
        "B2C",
        "C2C"
      ],
      "title": "BusinessModel",
      "type": "string"
    },
    "Company": {
      "properties": {
        "name": {
          "description": "Name of the identified company",
          "title": "Name",
          "type": "string"
        },
        "type": {
          "$ref": "#/$defs/CompanyEnum",
          "description": "Type of the identified company"
        },
        "relationship": {
          "$ref": "#/$defs/CompanyRelation",
          "description": "Relationship of the identified company with the startup from the deck"
        }
      },
      "required": [
        "name",
        "type",
        "relationship"
      ],
      "title": "Company",
      "type": "object"
    },
    "CompanyEnum": {
      "enum": [
        "school",
        "investor",
        "startup",
        "corporate"
      ],
      "title": "CompanyEnum",
      "type": "string"
    },
    "CompanyRelation": {
      "enum": [
        "founderBackground",
        "investor",
        "competitor",
        "client",
        "partnership"
      ],
      "title": "CompanyRelation",
      "type": "string"
    },
    "TeamMember": {
      "properties": {
        "firstName": {
          "description": "First name of the team member",
          "title": "Firstname",
          "type": "string"
        },
        "lastName": {
          "description": "Last name of the team member",
          "title": "Lastname",
          "type": "string"
        },
        "title": {
          "description": "Title, position of the team member",
          "title": "Title",
          "type": "string"
        },
        "pastExperiences": {
          "description": "Previous experiences",
          "title": "Pastexperiences",
          "type": "string"
        }
      },
      "required": [
        "firstName",
        "lastName",
        "title",
        "pastExperiences"
      ],
      "title": "TeamMember",
      "type": "object"
    }
  },
  "X-SystemPrompt": "\nYour task is to extract structured information from pitch decks based on the provided schema. Carefully analyze the content to identify relevant details and populate each field accurately while maintaining consistency across extracted data.\n\nKey Guidelines:\n\t1.\tUnderstanding the Schema:\n\t\u2022\tThe schema includes key entities such as the company, its investors, competitors, clients, team members, and business model. Each field must be carefully reviewed and filled with precise data extracted from the deck.\n\t\u2022\tRelationships between companies (e.g., investor, competitor, client) should be determined based on contextual evidence within the deck.\n\t2.\tContextual Analysis:\n\t\u2022\tConsider multiple slides to understand the startup's positioning, stakeholders, and market landscape.\n\t\u2022\tExtract information by recognizing patterns, such as recurring names or mentions in key slides (e.g., cap tables for investors, competitive analysis for competitors, and traction slides for clients).\n\t3.\tConsistency and Accuracy:\n\t\u2022\tEnsure extracted data is consistent across all fields and accurately reflects the content of the deck.\n\t\u2022\tAvoid duplication or conflicting information by cross-referencing details from various slides.\n\t4.\tData Formatting:\n\t\u2022\tCompany Name: Extract the official name as presented in the deck, ensuring correctness.\n\t\u2022\tWebsite: Extract and format URLs correctly \n\t\u2022\tCountry: Convert to the appropriate two-letter country code for uniformity.\n\t\u2022\tBusiness Model: Determine whether the startup follows B2B, B2C, or C2C based on their product offerings and customer base.\n\t5.\tHandling Team Data:\n\t\u2022\tIdentify key team members, ensuring correct extraction of their first name, last name, title, and previous experiences.\n\t\u2022\tPrioritize executives and founding members when available.\n\t6.\tDealing with Missing Information:\n\t\u2022\tIf some details are not explicitly stated, infer them based on available context or leave them blank if they cannot be determined with certainty.\n\t\u2022\tEnsure no assumptions are made beyond what is supported by the content.\n\nExtraction Output:\n\t\u2022\tThe extracted data should strictly adhere to the defined schema, ensuring each field is correctly populated according to its description.\n\t\u2022\tThe output should be structured, with proper data types (e.g., strings, enumerations, lists) and validated before final submission.\n\nBy following these principles, the extracted information will be comprehensive, accurate, and aligned with the expected data structure for further processing and analysis.\n",
  "properties": {
    "name": {
      "description": "Name of the company",
      "title": "Name",
      "type": "string"
    },
    "website": {
      "description": "URL of the company website",
      "title": "Website",
      "type": "string"
    },
    "country": {
      "description": "2 letter Country code of the company ",
      "title": "Country",
      "type": "string"
    },
    "investors": {
      "$ref": "#/$defs/Company",
      "X-ReasoningPrompt": "Think about the investors. Detail your thought process, and explain logically, step by step, who are the investors, detailing the cues and evidence for each one. For example: 1) Found X in cap table showing Y% ownership 2) Identified Z from 'backed by' slide with logo and investment date 3) etc.",
      "description": "Existing investors in the startup"
    },
    "competitors": {
      "$ref": "#/$defs/Company",
      "X-ReasoningPrompt": "Walk through your analysis of the competitive landscape step by step: 1) Which companies are positioned as direct competitors? 2) What specific features/offerings overlap? 3) What market segments do they compete in? 4) What evidence supports each competitor identification?",
      "description": "Competitors identified by the startup in the deck"
    },
    "clients": {
      "$ref": "#/$defs/Company",
      "X-ReasoningPrompt": "Break down your client analysis systematically: 1) Which companies are mentioned as current clients vs pipeline? 2) What evidence shows their client status (testimonials, case studies, logos)? 3) What stage is each client relationship? 4) Are there any specific metrics or success stories mentioned?",
      "description": "Clients (B2B) in pipe or signed by the startup in the deck"
    },
    "team": {
      "X-ReasoningPrompt": "Analyze the team composition methodically: 1) Who are the key founders/executives? 2) What specific evidence validates their roles? 3) How did you verify their background and experience? 4) What makes their experience relevant to this venture?",
      "description": "Company Team",
      "items": {
        "$ref": "#/$defs/TeamMember"
      },
      "title": "Team",
      "type": "array"
    },
    "businessModel": {
      "$ref": "#/$defs/BusinessModel",
      "X-ReasoningPrompt": "Explain your business model classification process: 1) Who are the primary customers? 2) What is the revenue generation method? 3) How does the product/service flow between parties? 4) What specific slides or content supports this classification?",
      "description": "Business model of the startup"
    }
  },
  "required": [
    "name",
    "website",
    "country",
    "investors",
    "competitors",
    "clients",
    "team",
    "businessModel"
  ],
  "title": "Deck",
  "type": "object"
}

```

```json result_with_reasoning.json
{
  "name": "AirBed&Breakfast",
  "website": "airbedandbreakfast.com",
  "country": "US",
  "reasoning___investors": "1) The funding is specified in the Financial slide, indicating an angel round of $500K. 2) Although there are no named investors in the slides, the need for angel investment suggests relationships with high-net-worth individuals or investor groups interested in startups.",
  "investors": {
    "name": "Angel Investors",
    "type": "investor",
    "relationship": "investor"
  },
  "reasoning___competitors": "1) The competitive landscape is represented in the Competition slide which lists CouchSurfing, Craigslist, BedandBreakfast.com, Hostels.com, Rentabi.com, Orbitz, and others. 2) Features such as rental transactions and budget accommodation indicate they overlap with AirBed&Breakfast's offering.",
  "competitors": {
    "name": "CouchSurfing",
    "type": "startup",
    "relationship": "competitor"
  },
  "reasoning___clients": "1) The slides do not mention specific clients or partnerships currently signed on with AirBed&Breakfast. 2) Potential users, however, include travelers looking for budget accommodations, but this is more potential clientele than current clients.",
  "clients": {
    "name": "Travelers",
    "type": "startup",
    "relationship": "client"
  },
  "reasoning___team": "1) The team consists of Joe Gebbia, Brian Chesky, and Nathan Blecharczyk, all featured in the Team slide. 2) Each team member has definitive roles in User Interface, Business Development, and Development, which complement the startup's needs.",
  "team": [
    {
      "firstName": "Joe",
      "lastName": "Gebbia",
      "title": "User Interface & PR",
      "pastExperiences": "Entrepreneur and designer, graduated from Rhode Island School of Design."
    },
    {
      "firstName": "Brian",
      "lastName": "Chesky",
      "title": "Business Development & Brand",
      "pastExperiences": "Founder of Brian Chesky, Inc., industrial design consultant, graduated from Rhode Island School of Design."
    },
    {
      "firstName": "Nathan",
      "lastName": "Blecharczyk",
      "title": "Developer",
      "pastExperiences": "Created Facebook apps, graduate from Harvard."
    }
  ],
  "reasoning___businessModel": "1) The business model is determined by the revenue generation method which is taking a 10% commission on each transaction as stated in the Business Model slide. 2) The primary customers are travelers and local hosts, confirming B2C positioning.",
  "businessModel": "B2C"
}
```

```json final_result.json
{
  "name": "AirBed&Breakfast",
  "website": "airbedandbreakfast.com",
  "country": "US",
  "investors": {
    "name": "Angel Investors",
    "type": "investor",
    "relationship": "investor"
  },
  "competitors": {
    "name": "CouchSurfing",
    "type": "startup",
    "relationship": "competitor"
  },
  "clients": {
    "name": "Travelers",
    "type": "startup",
    "relationship": "client"
  },
  "team": [
    {
      "firstName": "Joe",
      "lastName": "Gebbia",
      "title": "User Interface & PR",
      "pastExperiences": "Entrepreneur and designer, graduated from Rhode Island School of Design."
    },
    {
      "firstName": "Brian",
      "lastName": "Chesky",
      "title": "Business Development & Brand",
      "pastExperiences": "Founder of Brian Chesky, Inc., industrial design consultant, graduated from Rhode Island School of Design."
    },
    {
      "firstName": "Nathan",
      "lastName": "Blecharczyk",
      "title": "Developer",
      "pastExperiences": "Created Facebook apps, graduate from Harvard."
    }
  ],
  "businessModel": "B2C"
}
```


</CodeGroup>



## Conclusion
In this tutorial, we've successfully extracted structured data from the Airbnb pitch deck using Retab and OpenAI, leveraging Pydantic models for data validation and schema definition.
